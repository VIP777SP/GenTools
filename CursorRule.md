# Genshin Tools 開発メモ

## 概要
Genshin Impact ティアメーカーアプリケーション
- Next.js, TypeScript, Tailwind CSS, @dnd-kit使用
- キャラクター、武器、聖遺物のティアランキング機能

## 進捗ログ

### 2024/12/19 - UI調整
- ティア表示を5列から4列に変更 (DroppableArea.tsx)

### 2024/12/19 - 武器アセット管理
- 武器アイコン自動ダウンロードスクリプト作成 (weapon_icons_downloader.py)
- 104個の武器アイコンを100%成功率でダウンロード
- weaponlist.ts作成 (TypeScript型定義、英語武器タイプ)
- charlist.tsに武器タイプ追加 (97キャラクター対応)

### 2024/12/19 - 聖遺物アセット管理
- artifacts.ts作成 - 聖遺物データ型定義
  - 51個の聖遺物セット (5星:38, 4星:10, 3星:3)
  - TypeScript型安全性: rarity: 3|4|5
- 自動ダウンロードスクリプトは失敗 (URLパターン相違)
- 手動ダウンロードスクリプト作成・拡張 (artifact_manual_downloader.py)
- **50/51個の聖遺物アイコン成功ダウンロード (98.0%)**
  - 成功: Genshin Impact Wiki redirect URLパターンが有効
  - 失敗: 深層秘境の長夜 (1個のみ)
  - 全カテゴリ網羅: 5星37個、4星10個、3星3個

## フォルダ構造
```
genshin-tools/
├── src/libs/
│   ├── charlist.ts (97キャラクター + weaponType)
│   ├── weaponlist.ts (104武器)
│   └── artifacts.ts (51聖遺物)
├── public/images/
│   ├── characters/ (既存)
│   ├── weapons/ (104ファイル)
│   └── artifacts/ (50ファイル - ほぼ完成)
```

## 今後のタスク
1. [x] ~~残り46個の聖遺物アイコン収集~~ → 完了 (50/51)
2. [ ] 残り1個の聖遺物アイコン手動追加
3. [ ] 聖遺物ティアメーカーUI実装
4. [ ] 複数カテゴリ対応 (キャラ/武器/聖遺物切り替え)

## 技術メモ
- weapon/charのURLパターンは安定
- 聖遺物はGenshin Wiki Special:Redirect URLが最適
- 複数フォールバックURL戦略が有効 (98%成功率達成)
- TypeScript Union型で型安全性確保
- 聖遺物アイコンサイズ: 26KB～85KB (平均約55KB)

# 原神ティアメーカー開発ルール

## 🎯 実装済み機能

### 1. ビルド設定システム
- **CharacterBuild型**: 凸数、武器、聖遺物の設定
- **ビルド設定モーダル**: キャラクター別の詳細設定
- **アイコン表示**: キャラクター画像にビルド情報を重ね表示
- **状態管理**: characterBuilds (Record<number, CharacterBuild>)で管理

### 2. UIレスポンシブ対応
- **動的アイコンサイズ**: ResizeObserverでコンテナサイズを監視
- **4段階サイズ対応**: 60px以下、80px以下、120px以下、120px超
- **React Icons使用**: IoSettingsSharp、HiDotsVertical

### 3. ティア表最適化
- **ラベル領域縮小**: w-20 (80px) → w-12 (48px) に変更
- **設定ボタン最適化**: 右上隅配置、サイズ縮小 (w-4 h-4)
- **設定パネル位置変更**: ラベル右側に表示でドロップエリアを妨げない
- **フォントサイズ調整**: 狭い領域でも読みやすいように最適化
- **ドロップエリア拡大**: より多くのキャラクターを配置可能

### 4. キャラクターコピー機能
- **コピーボタン**: 右下隅に緑色のコピーアイコン (IoCopyOutline)
- **同一ティア内複製**: 同じキャラクターを複数回配置可能
- **一意ID生成**: タイムスタンプ + ランダム値で重複回避
- **ビルド設定継承**: コピー時に元のビルド設定も複製
- **レスポンシブ対応**: 全サイズでコピーボタンが適切に表示

### 5. キャラクター削除機能 ⭐ NEW
- **削除ボタン**: 左下隅に赤色の×アイコン (IoCloseSharp)
- **ティアから削除**: 配置されたキャラクターを個別削除可能
- **ビルド設定削除**: コピーキャラクターの場合はビルド設定も削除
- **オリジナル保護**: 元キャラクターのビルド設定は保持
- **レスポンシブ対応**: 全サイズで削除ボタンが適切に表示
- **競合回避**: 左下配置でビルド情報アイコンとの重複を防止

## 📊 データ統計
- キャラクター数: 97 (100%取得成功)
- 武器数: 104 (100%取得成功) 
- 聖遺物数: 51 (100%取得成功)

## 🛠 技術仕様

### キャラクター削除実装詳細
- **削除ボタン**: bottom-left配置、z-index=10で最前面表示
- **状態管理**: tiers配列からfilterで該当キャラクター除去
- **ビルド設定管理**: オリジナルキャラクターかコピーかを判定
- **Props継承**: showRemoveButton=true でティア内のみ表示
- **配置最適化**: 左下隅でビルド情報アイコンとの競合を回避

### キャラクターコピー実装詳細
- **ID生成**: `${character.id}${timestamp}${random}`.slice(-8) で8桁調整
- **状態管理**: tiers配列とcharacterBuilds辞書を同期更新
- **キー管理**: `${char.id}-${index}` でReactのkey重複回避
- **Props継承**: showCopyButton=true でティア内のみ表示
- **イベント伝播**: e.stopPropagation() でドラッグ操作と分離

### ラベル領域最適化詳細
- **幅**: 48px固定 (従来比40%削減)
- **レイアウト**: flex-col で縦方向中央揃え
- **テキスト**: wordBreak: break-all で自動改行
- **設定ボタン**: 10px アイコン、右上隅配置
- **設定パネル**: left-full ml-2 で右側表示

### 状態管理パターン
- Props drilling方式でビルドデータを各コンポーネントに配布
- TierMakerClient.tsx が状態の中心地
- characterBuilds: Record<number, CharacterBuild> で管理

### パフォーマンス
- ResizeObserver使用で効率的なサイズ監視
- useEffect cleanup でメモリリーク防止
- React.memo 未使用 (将来の最適化候補)

## 🎨 デザイン原則
- 透明PNGには背景色必須 (bg-gray-800/700)
- アクセシビリティ考慮のホバー効果
- 一貫したカラーパレット使用
- タッチ操作対応のボタンサイズ
- 赤色削除ボタンで危険操作を明示
- 緑色コピーボタンで直感的操作
- 4隅機能配置でUIの競合回避

### UI配置戦略
- **左上**: ビルド情報アイコン（凸数、武器、聖遺物）
- **右上**: ビルド設定ボタン（青色・設定アイコン）
- **左下**: 削除ボタン（赤色・×アイコン）
- **右下**: コピーボタン（緑色・コピーアイコン）

## 📝 今後の改善候補
- [ ] React.memo を使用したレンダリング最適化
- [ ] ラベル文字数制限の視覚的フィードバック
- [ ] ドラッグ&ドロップ時のスナップ機能
- [ ] キーボードショートカット対応
- [ ] コピー数制限機能（無制限コピー防止）
- [ ] 削除確認ダイアログ（誤操作防止）

## 最新の開発状況 (2024-11-XX)

### 完了済み機能

#### サイトトップページ作成完了 (2024-12-XX)
- **機能**: 魅力的なランディングページを作成
- **デザイン**: 
  - ヒーローセクション（大きなタイトル + CTAボタン）
  - 機能紹介セクション（3つのカード：ツール集、攻略記事、リンク集）
  - 統計セクション（97+キャラクター、104+武器、51+聖遺物、4+ツール）
  - フッターCTA（最終的な行動喚起）
- **UX/UI**:
  - グラデーション背景とアニメーション
  - React Icons使用（IoSparklesOutline等）
  - ホバーエフェクト（scale、rotate、translate）
  - レスポンシブデザイン
  - 美しいグラデーションテキスト
- **ナビゲーション**: 各セクションへの適切なリンク設定

#### gs-toolsトップページ作成 (2024-12-XX)
- **機能**: ツール集のランディングページを作成
- **デザイン**: 
  - カード形式のレイアウト（grid-cols-2）
  - react-icons/io5を使用したアイコン
  - グラデーション背景とホバーエフェクト
  - 利用可能/開発予定のステータス表示
- **ツール一覧**:
  - Tierメーカー（利用可能）
  - ビルド最適化（開発予定）
  - ガチャ履歴（開発予定）
  - ダメージ計算機（開発予定）
- **UX/UI**:
  - スッキリとしたモダンデザイン
  - ホバーアニメーション
  - 拡張しやすい構造

#### ボタンレイアウト最適化 (2024-12-XX)
- **問題**: 3つのボタンが横並びで幅を取りすぎている
- **解決策**: 2+1レイアウトに変更
  - 左側: 編集機能（Tier追加 + リセット）をグループ化
  - 右側: 保存機能を独立配置
  - 全体をコンパクト化（px-5→px-4, py-3→py-2.5, rounded-xl→rounded-lg）
  - アイコンサイズ縮小（18px→16px）
  - マージン調整（mr-2→mr-1.5）
- **メリット**: 
  - 機能的な関連性による整理
  - よりコンパクトなレイアウト
  - 視覚的なバランスの向上 