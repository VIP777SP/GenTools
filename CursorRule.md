# 開発メモ

## 記事一覧ページ - ページネーション実装 (2024/12/XX)

### 要件
- 25件の記事が一度に表示されてスクロールが長くなる問題を解決
- ページネーション形式での区切り表示を実装

### 実装内容
1. **ページ状態管理**: currentPage, ITEMS_PER_PAGE(10件)
2. **ページネーション計算**: totalPages, startIndex, endIndex, currentArticles
3. **カテゴリ変更時**: 自動的に1ページ目に戻る処理
4. **ページ変更時**: 上部へのスムーズスクロール
5. **UI要素**: 前へ・次へボタン（端で無効化）、ページ番号ボタン、件数表示

### 技術的ポイント
- `Array.slice()` で該当ページの記事を抽出
- `Math.ceil()` で総ページ数を計算
- `window.scrollTo({ behavior: 'smooth' })` でスムーズスクロール
- 条件分岐によるボタンの有効/無効化
- カテゴリ変更とページリセットの連動

### 結果
10件/ページ表示で、快適なブラウジング体験を実現

## 記事データ復元 (2024/12/XX)

### 課題
- プレースホルダー記事生成コード削除時に元の記事データも消失

### 復元した記事
1. おすすめ武器ランキング (攻略・おすすめ)
2. おすすめ聖遺物ランキング (攻略・おすすめ)  
3. サポーターが強いだけじゃん反論記事 (ブログ・ネタ)
4. 原神、起動とは？ミーム解説 (ネタ)
5. 個人的に使ってみたい完凸キャラ (ブログ)

### 特徴
- getTagColor関数で定義されたタグと一致
- 原神プレイヤーに親しみやすいタイトル
- 複数カテゴリ対応

## ヘッダー固定表示実装 (2024/12/XX)

### 要件
- ヘッダーをページ最上部に常駐させる
- スクロール時も常にアクセス可能なナビゲーション

### 実装内容
1. **ヘッダー固定**: `position: fixed` でヘッダーを画面上部に固定
2. **レイアウト調整**: メインコンテンツに上部パディング追加
3. **z-index管理**: ヘッダー(z-50) > オーバーレイ(z-40) の階層構造

### 技術的ポイント
- `fixed top-0 left-0 right-0`: 画面上部全体に固定配置
- `z-50`: 他要素より前面に表示
- `pt-16`: メインコンテンツの上部に64pxパディング追加
- 既存のサイドバー機能との競合回避

### 結果
スクロール位置に関係なくハンバーガーメニューに常時アクセス可能

## フッターナビゲーション実装 (2024/12/XX)

### 課題
- フッターバーの見た目は完成していたが、リンク機能が未実装
- メニュー項目がクリックできない状態

### 実装内容
1. **Next.js Linkコンポーネント**: `import Link from "next/link"` 追加
2. **リンク機能**: `<div>` から `<Link>` に変更して各メニューをクリック可能に
3. **ホバー効果**: `hover:opacity-70 transition-opacity` でUX向上

### 技術的ポイント
- Next.jsの公式ルーティングでSPA風のページ遷移
- プリフェッチ機能による高速なナビゲーション
- CSSトランジションによるスムーズなホバー効果

### ルーティング
- ホーム: `/`
- 記事: `/gs-articles` 
- ツール集: `/gs-tools`
- リンク集: `/gs-links`

### 結果
フッターバーから各セクションへの快適なナビゲーションが可能

## キャラクターリスト完成 (2024/12/XX)

### 目的
- tiermaker作成機能のためのキャラクターデータベース構築
- public/images/charactersフォルダの全画像ファイルをリスト化

### 実装内容
1. **全97体対応**: フォルダ内の全キャラクター画像をカバー
2. **元素別整理**: 風/水/雷/氷/炎/岩/草の7元素でグループ化
3. **TypeScript型定義**: character型で型安全性確保
4. **統一命名**: 日本語キャラクター名で一貫性保持

### データ構造
```typescript
export type character = {
    id: number,      // 1-97の固有ID
    name: string,    // 日本語キャラクター名
    iconUrl: string  // /images/characters/配下のパス
};
```

### 元素別内訳
- 風元素: 13体 | 水元素: 14体 | 雷元素: 14体 | 氷元素: 16体
- 炎元素: 16体 | 岩元素: 11体 | 草元素: 10体 | 主人公: 3体

### 結果
tiermaker機能で使用可能な完全なキャラクターデータベースが完成

## Tiermaker基本実装 (2024/12/XX)

### 要件
- dnd-kitを使用したドラッグ&ドロップ機能
- キャラクター画像を使用したTier表作成機能
- 直感的なUI/UX

### 実装方式
**HTML5 Drag & Drop API使用** (dnd-kit導入済みだが、シンプル実装のためネイティブAPIを採用)

### 主要コンポーネント
1. **DraggableCharacter**: ドラッグ可能なキャラクター画像
2. **TierRow**: S/A/B/C/D の各Tier段階
3. **CharacterSelection**: 未配置キャラクター選択エリア

### 機能実装
1. **ドラッグ&ドロップ**: キャラクター選択→Tier表配置
2. **Tier間移動**: 配置済みキャラクターの再配置可能
3. **重複防止**: 同一キャラクターの複数配置を防止
4. **リセット機能**: 全配置クリア
5. **レスポンシブ**: グリッド表示でモバイル対応

### Tier表構造
- S(赤) / A(オレンジ) / B(黄) / C(緑) / D(青) の5段階
- 各段階80px最小高さ、フレックスレイアウト
- 配置済みキャラクターは選択エリアから除外

### 技術的ポイント
- `dataTransfer.setData/getData` でキャラクターID受け渡し
- Set構造で配置済みキャラクター管理
- 状態更新時の不変性維持

### 今後の拡張予定
- 画像保存機能
- カスタムTier名編集
- ドラッグ中のビジュアルフィードバック改善

## キャラクターリスト元素順変更 (2024/12/XX)

### 要件
- tiermakerのキャラクター選択画面での表示順変更
- 風・水・雷... から 炎・水・氷・雷・風・岩・草 の順に変更

### 実装内容
1. **元素順変更**: charlist.tsの配列順を並び替え
2. **ID振り直し**: 新しい順序に合わせて1-97で連番に再設定
3. **データ整合性**: 画像パスとキャラクター名は維持

### 新しい元素順序
炎(1-16) → 水(17-30) → 氷(31-46) → 雷(47-60) → 風(61-73) → 岩(74-84) → 草(85-94) → 主人公(95-97)

### 効果
- より直感的なキャラクター選択体験
- 原神の一般的な元素順序に準拠
- tiermaker使用時の利便性向上

## Tiermaker行追加機能実装 (2024/12/XX)

### 要件
- 固定のS/A/B/C/D Tierを動的に追加・削除・編集可能にする
- ユーザーが自由にTier表をカスタマイズできる機能

### 実装機能
1. **動的行管理**
   - Tier行の追加（無制限）
   - Tier行の削除（最低1行保証）
   - 自動ID生成（`tier_${timestamp}`）

2. **ラベル編集**
   - クリックでインライン編集
   - Enter/Escapeキー対応
   - 最大3文字制限

3. **色カスタマイズ**
   - 10色パレット（赤/橙/黄/緑/青/紫/桃/藍/灰/青緑）
   - ホバー表示の色選択UI
   - 現在色のリング表示

4. **UIコントロール**
   - ホバーでコントロールボタン表示
   - 🎨アイコンと×ボタン
   - レスポンシブボタン配置

### 技術実装
- **状態管理**: `useState<TierDefinition[]>` で動的Tier管理
- **型安全性**: TierDefinition interface で構造化
- **イミュータブル**: スプレッド演算子による状態更新
- **条件レンダリング**: canDelete prop で削除ボタン制御

### データ構造
```typescript
interface TierDefinition {
  id: string;        // 一意識別子
  label: string;     // 表示ラベル
  color: string;     // Tailwind色クラス
}
```

### UX改善ポイント
- 直感的なクリック編集
- ホバーでのコントロール表示
- キーボードショートカット対応
- 視覚的フィードバック（色変更アニメーション）

### 今後の拡張
- Tier行の並び替え（ドラッグ&ドロップ）
- カスタム色の追加
- Tier表テンプレートの保存・読み込み

## Tier設定UI改善 (2024/12/XX)

### 課題
- インライン編集とホバーボタンが分かりづらい
- 小さな操作エリアで誤操作が発生しやすい
- モバイル環境での操作性が悪い

### 改善方針
設定ボタン → ドロップダウンパネル方式に変更

### 実装内容
1. **設定ボタン配置**
   - Tierラベル右上に⚙️アイコン配置
   - 常時表示でアクセスしやすく

2. **ドロップダウン設定パネル**
   - 280px幅の専用パネル
   - ラベル編集・色選択・削除を統合
   - 適切なz-index(50)で最前面表示

3. **UX改善**
   - 外クリックで自動クローズ
   - オーバーレイで操作領域を明確化
   - 削除・閉じるボタンの明確な配置

### UI構成
```
┌─ 設定パネル ─────────────┐
│ Tier設定                 │
│ ─────────────────────── │
│ ラベル名: [入力フィールド] │
│ 背景色: [カラーパレット]   │
│ [このTier行を削除]        │
│ [閉じる]                 │
└─────────────────────────┘
```

### 技術改善点
- インライン編集の複雑性削除
- ホバー状態管理の簡略化
- 単一状態 `showSettings` で管理
- 操作完了時の自動パネルクローズ

### 効果
- 操作の明確性向上
- 誤操作の大幅減少
- モバイル環境での使いやすさ改善
- 設定項目へのアクセシビリティ向上

# Cursor開発ルール

## 開発メモ

### 2024年12月19日：Tiermaker ドラッグ&ドロップ実装

#### 問題
- @dnd-kitのHydrationエラーが発生
- スマホでのドラッグ操作が不安定
- Character選択欄のスクロールとドラッグが競合

#### 解決アプローチ
1. **Hydration問題**: 動的インポート（Dynamic Import）でSSR無効化
2. **Z-index問題**: DragOverlayで最前面表示
3. **スマホ操作**: TouchSensor + MouseSensor + PointerSensorの組み合わせ
4. **スクロール競合**: touchAction設定とセンサーの調整

#### 現在の設定
```typescript
// 複数センサーで確実にドラッグ検知
const sensors = useSensors(
  useSensor(MouseSensor, { activationConstraint: { distance: 5 } }),
  useSensor(TouchSensor, { activationConstraint: { distance: 5 } }),
  useSensor(PointerSensor, { activationConstraint: { distance: 5 } })
);
```

#### 今後の課題
- スマホでのスクロールとドラッグの完全な分離
- タッチ操作の反応性向上

## プロジェクト構成
- Next.js App Router
- TypeScript
- Tailwind CSS
- @dnd-kit（ドラッグ&ドロップ）

## 気づき・メモ
- 動的インポートはHydration問題の有効な解決策
- タッチデバイスでのドラッグ操作は複数センサーの組み合わせが重要

## 2024年 - Tiermaker ドラッグ＆ドロップ問題の解決

### 問題の経緯
- モバイルで横スクロールコンテナ内のドラッグ＆ドロップが動作しない
- iOS/Androidで タッチ操作とスクロール操作が競合

### 解決策: tiermaker.com方式の採用（スクロールとドラッグの物理的分離）

#### 実装した仕組み
1. **上段（横スワイプ検知エリア）**
   - 非ドラッグ領域での横スワイプ検知
   - "ここをタッチしてスワイプ"表示
   - マウス・タッチイベントで下段のスクロールを制御

2. **中段（ドラッグ可能キャラクターエリア）**
   - 選択済みキャラクターのドラッグ可能表示
   - スクロール機能なし、ドラッグのみに特化
   - 上段・下段と物理的に分離

3. **下段（キャラクター横スクロールリスト）**
   - 全キャラクターの横スクロール一覧
   - クリック選択のみ（ドラッグ無効）
   - 上段のスワイプ操作と連動してスクロール

#### 技術実装の詳細

**スワイプ連動システム**
```typescript
const handleSwipeMove = (e: React.TouchEvent | React.MouseEvent) => {
  if (!isSwipping || !scrollRef.current) return;
  const clientX = 'touches' in e ? e.touches[0].clientX : e.clientX;
  const walk = (startX - clientX) * 2; // スクロール速度調整
  scrollRef.current.scrollLeft = scrollLeft + walk;
};
```

**エリア分離設計**
- 上段: `touchAction: 'none'` でスワイプ検知専用
- 中段: ドラッグ専用エリア（スクロール無効）
- 下段: 横スクロール専用（ドラッグ無効）

#### メリット
1. **完全な競合回避**: スクロールエリアとドラッグエリアが物理的に分離
2. **直感的操作**: 上でスワイプ→下がスクロールの明確な関係
3. **モバイル最適化**: タッチ操作に最適化された3段構造
4. **確実性**: どの操作がどの結果をもたらすかが明確

#### 今回の学び
- モバイルでのドラッグ＆ドロップは横スクロールと相性が悪い
- 既存サービス（tiermaker.com）のUXパターンを参考にするのが有効
- **機能の物理的分離**（ドラッグ vs スクロール）が根本的解決につながる
- @dnd-kitでも物理的な制約（スクロールコンテナ）は解決できない
- **スワイプ連動システム**でUXを損なわずに競合を回避可能

### 次の改善予定
- 画像として保存機能（html2canvas使用予定）
- ティア行の並び替え機能
- キーボードショートカット対応
